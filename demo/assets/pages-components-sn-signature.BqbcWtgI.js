import{_ as e}from"./sn-topbar.wm0GzhH3.js";import{d as t,$ as l,r as a,c as n,w as u,y as o,n as s,o as i,a as r,h as d,g as v,f as c,p,u as f,z as g,B as y,F as m,x as h,s as b,_ as x,b as S,e as _,aD as w,aE as T,aF as C}from"./index-DYMgrqHp.js";import{r as j}from"./uni-app.es.DgDfNdgy.js";import{_ as k}from"./com-card.BtLNzB63.js";import{a as O,b as U}from"./sn-text.euomPoe8.js";import{_ as R}from"./sn-button.BjZePiC5.js";import{_ as B}from"./sn-view.BSUxthDa.js";import{_ as N}from"./sn-image.C1FMMqQw.js";import{_ as z}from"./sn-gap.2Twkbobz.js";import{_ as A}from"./sn-page.Cf6LEMVT.js";import"./sn-menu-item.DkjoXkWj.js";import"./sn-overlay.CiZFgEyq.js";import"./sn-loading.t5otRKvs.js";import"./useResize.Cfi37DcV.js";class D extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1}}}}}constructor(e,t=D.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,delete this.__props__}}const J=U(t(Object.assign({name:"sn-signature"},{__name:"sn-signature",props:{text:{type:String,default:"请签名"},textFont:{type:String,default:""},textColor:{type:String,default:""},penSize:{type:Number,default:3},penColor:{type:String,default:""},height:{type:String,default:"150px"},bgColor:{type:String,default:""},disabled:{type:Boolean,default:!1},borderRadius:{type:String,default:""},buttonSpacing:{type:String,default:"5px"},maxHistory:{type:Number,default:20},clearTip:{type:String,default:"清空后数据无法找回，您确定要清空吗？"},showClearTip:{type:Boolean,default:!0},showAction:{type:Boolean,default:!0},showUndo:{type:Boolean,default:!0},showRedo:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0},showClear:{type:Boolean,default:!0},undoText:{type:String,default:"撤销"},redoText:{type:String,default:"重做"},clearText:{type:String,default:"清空"},confirmText:{type:String,default:"确定"},customStyle:{type:Object,default:new UTSJSONObject({})},customCanvasStyle:{type:Object,default:new UTSJSONObject({})},customActionAreaStyle:{type:Object,default:new UTSJSONObject({})}},emits:["confirm","undo","redo","clear"],setup(e,t){var k=t.expose,U=t.emit;const N=l.utils,z=l.colors,A=U,J=e,M=N.randomComId(),$=a(0),E=a(null),P=a(null),H=a(null),F=a(null),L=a(0),X=a(0),Y=a(0),I=a([]),W=a(-1),K=a(!1),Q=a([]),V=n((()=>new UTSJSONObject({penSize:J.penSize,penColor:J.penColor,height:J.height,maxHistory:J.maxHistory}))),Z=n((()=>h("color",J.bgColor,z.value.front))),q=n((()=>h("color",J.textColor,z.value.line))),G=n((()=>h("color",J.penColor,z.value.text))),ee=n((()=>N.addPx(L.value/J.text.length*.8))),te=n((()=>h("radius",J.borderRadius,l.configs.radius.normal))),le=n((()=>{const e=new Map;return e.set("height",J.height),e.set("border-radius",te.value),e.set("background",Z.value),e.set("transition-duration",l.configs.aniTime.normal),e})),ae=n((()=>{const e=new Map;return e.set("transition-duration",l.configs.aniTime.normal),e})),ne=n((()=>{const e=new Map;return e.set("flex-direction","row"),e.set("align-items","center"),e.set("justify-content","flex-end"),e.set("margin-top","5px"),e.set("padding","10px"),e})),ue=n((()=>{const e=new Map;return e.set("margin-left",J.buttonSpacing),e}));function oe(e){if(null!=H.value&&Q.value.length>1){let t=Q.value[Q.value.length-2];H.value.beginPath(),H.value.moveTo(t.x,t.y),H.value.lineTo(e.x,e.y),H.value.stroke(),H.value.closePath(),H.value.save()}}function se(e){if(null!=H.value){for(let t=0;t<e.length;t++)Q.value.push(e[t]),oe(e[t]);Q.value=[]}}function ie(){if(null!=H.value){H.value.strokeStyle=G.value,H.value.fillStyle=G.value,H.value.clearRect(0,0,F.value.width,F.value.height);for(let e=0;e<=W.value;e++)se(I.value[e])}}function re(){if(W.value<0||0==I.value.length)return null;null!=H.value&&I.value.length>0&&W.value>=0&&(W.value--,ie(),A("undo"))}function de(){if(0==I.value.length||W.value>=I.value.length-1)return null;null!=H.value&&W.value<=I.value.length-1&&(W.value++,ie(),A("redo"))}function ve(){null!=H.value&&H.value.clearRect(0,0,F.value.width,F.value.height),I.value=[],Q.value=[],W.value=-1,A("clear")}function ce(){J.showClearTip?b(new UTSJSONObject({title:"提示",content:J.clearTip,success:function(e){e.confirm&&ve()}})):ve()}function pe(){A("confirm")}function fe(e,t){return new D({x:e-X.value,y:t-Y.value})}function ge(){var e,t,l,a;let n=null===(e=E.value)||void 0===e?void 0:e.getBoundingClientRect();L.value=null!==(t=null==n?void 0:n.width)&&void 0!==t?t:0,Y.value=null!==(l=null==n?void 0:n.top)&&void 0!==l?l:0,X.value=null!==(a=null==n?void 0:n.left)&&void 0!==a?a:0}function ye(e,t){ge(),K.value=!0;let l=fe(e,t);Q.value.push(l)}function me(e){e.preventDefault();let t=e.touches[0];ye(t.clientX,t.clientY)}function he(e,t){if(!K.value)return null;let l=fe(e,t);Q.value.push(l),oe(l)}function be(e){e.preventDefault();let t=e.touches[0];he(t.clientX,t.clientY)}function xe(e){if(0==Q.value.length)return null;W.value+1<I.value.length?(I.value=I.value.slice(0,W.value+1),I.value.push(Q.value),W.value++):(W.value++,I.value.push(Q.value)),Q.value=[],e.preventDefault(),K.value=!1}function Se(e){e.preventDefault(),ye(e.clientX,e.clientY)}function _e(e){xe(e)}function we(e){he(e.clientX,e.clientY),e.preventDefault()}function Te(){I.value=[],Q.value=[],W.value=-1,w({id:M,success:e=>{var t;P.value=e,H.value=e.getContext("2d"),F.value=H.value.canvas,$.value=null!==(t=C().devicePixelRatio)&&void 0!==t?t:1,F.value.width=F.value.offsetWidth*$.value,F.value.height=F.value.offsetHeight*$.value,H.value.scale($.value,$.value),H.value.restore(),null!=H.value&&(H.value.lineCap="round",H.value.lineJoin="round",H.value.lineWidth=J.penSize,H.value.strokeStyle=G.value,H.value.fillStyle=G.value),ge()}})}return k({undo:re,redo:de,clear:ce,getBase64:function(){return null!=P.value?P.value.toDataURL():""}}),u((()=>l.configs.app.theme),(()=>{ie()})),u(V,(()=>{s((()=>{Te()}))})),o((()=>{s((()=>{}))})),i((()=>{window.addEventListener("mouseup",_e),window.addEventListener("mousemove",we),s((()=>{Te()}))})),(t=null,l=null)=>{const a=j(r("sn-text"),O),n=T,u=x,o=j(r("sn-button"),R),s=j(r("sn-view"),B);return S(),d(m,null,[v(u,{class:"sn-signature-contain",style:p([f(le),e.customStyle])},{default:c((()=>[v(a,{align:"center",text:e.text,font:e.textFont,color:f(q),size:f(ee)},null,8,["text","font","color","size"]),v(u,{class:"sn-signature-board",ref_key:"boardEle",ref:E,onTouchstart:me,onTouchend:xe,onTouchcancel:xe,onTouchmove:be,onMousedown:Se,style:p([f(ae),e.customStyle])},{default:c((()=>[v(n,{class:"sn-signature-canvas",id:f(M),style:p([e.customCanvasStyle])},null,8,["id","style"])])),_:1},8,["style"])])),_:1},8,["style"]),e.showAction?g(t.$slots,"action",{key:0},(()=>[v(s,{class:"sn-signature-action-area",disabled:e.disabled,bgColor:f(Z),borderRadius:f(te),style:p([f(ne),e.customActionAreaStyle])},{default:c((()=>[e.showClear?(S(),_(o,{key:0,type:"error",level:"second",text:e.clearText,disabled:e.disabled||0==f(I).length,onClick:ce,style:p([f(ue)])},null,8,["text","disabled","style"])):y("",!0),e.showUndo?(S(),_(o,{key:1,text:e.undoText,disabled:e.disabled||0==f(I).length||f(W)<0||f(W)==f(I).length-e.maxHistory-1,onClick:re,style:p([f(ue)])},null,8,["text","disabled","style"])):y("",!0),e.showRedo?(S(),_(o,{key:2,text:e.redoText,disabled:e.disabled||0==f(I).length||f(W)>=f(I).length-1,onClick:de,style:p([f(ue)])},null,8,["text","disabled","style"])):y("",!0),e.showConfirm?(S(),_(o,{key:3,type:"primary",text:e.confirmText,disabled:e.disabled,onClick:pe,style:p([f(ue)])},null,8,["text","disabled","style"])):y("",!0)])),_:1},8,["disabled","bgColor","borderRadius","style"])]),!0):y("",!0)],64)}}})),[["__scopeId","data-v-670eabf3"]]),M=t({__name:"sn-signature",setup(t){l.colors,l.utils;const n=a(""),u=a(null),o=a(null);function s(){var e,t,l;n.value=null!==(l=null===(t=null===(e=o.value)||void 0===e?void 0:e.getBase64)||void 0===t?void 0:t.call(e))&&void 0!==l?l:""}return(t=null,l=null)=>{const a=j(r("sn-topbar"),e),i=j(r("com-card"),k),d=j(r("sn-signature"),J),p=j(r("sn-button"),R),g=j(r("sn-image"),N),y=j(r("sn-gap"),z),m=j(r("sn-page"),A);return S(),_(m,null,{default:c((()=>[v(a,{title:"Signature 签名"}),v(i,{title:"基础用法",note:"基于 canvas 的签名板，适配各端，内置一套精美模版，提供 20+ 属性，支持插槽定制操作栏，任意搭配"}),v(d,{ref_key:"signEle",ref:o},null,512),v(i,{title:"导出图片",note:"支持导出为 base64 图片，App 端还可利用 view 进行组件截图生成 png 图片"},{default:c((()=>[v(p,{text:"导出为 base64",onClick:s})])),_:1}),v(i,null,{default:c((()=>[v(g,{ref_key:"imageEle",ref:u,class:"m-t-10",enablePreview:"",src:f(n)},null,8,["src"])])),_:1}),v(y)])),_:1})}}});export{M as default};
