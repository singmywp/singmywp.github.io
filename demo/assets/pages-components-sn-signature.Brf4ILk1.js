import{_ as e}from"./sn-topbar.DxKzInQK.js";import{d as t,$ as l,r as a,c as n,w as u,z as o,m as s,l as i,a as r,g as d,f as v,e as c,q as f,u as p,B as g,C as y,F as h,y as m,s as b,j as x,o as S,b as w,av as _,aw as T,ax as C}from"./index-DoInGK9X.js";import{r as j}from"./uni-app.es.K1mZmM8s.js";import{_ as O}from"./com-card.D8_7_rS9.js";import{b as k,_ as U,c as B}from"./sn-button.B1LvAG78.js";import{_ as R}from"./sn-view.BKJ7GZxj.js";import{_ as N}from"./sn-image.BqpM2CW8.js";import{_ as z}from"./sn-gap.BM3gA-Sq.js";import{_ as A}from"./sn-page.Nlp4LDKz.js";import"./useResize.Dia-r-oM.js";class J extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{x:{type:Number,optional:!1},y:{type:Number,optional:!1}}}}}constructor(e,t=J.get$UTSMetadata$(),l=!1){super(),this.__props__=UTS.UTSType.initProps(e,t,l),this.x=this.__props__.x,this.y=this.__props__.y,delete this.__props__}}const M=B(t(Object.assign({name:"sn-signature"},{__name:"sn-signature",props:{text:{type:String,default:"请签名"},textFont:{type:String,default:""},textColor:{type:String,default:""},penSize:{type:Number,default:3},penColor:{type:String,default:""},height:{type:String,default:"150px"},bgColor:{type:String,default:""},disabled:{type:Boolean,default:!1},borderRadius:{type:String,default:""},buttonSpacing:{type:String,default:"5px"},maxHistory:{type:Number,default:20},clearTip:{type:String,default:"清空后数据无法找回，您确定要清空吗？"},showClearTip:{type:Boolean,default:!0},showAction:{type:Boolean,default:!0},showUndo:{type:Boolean,default:!0},showRedo:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0},showClear:{type:Boolean,default:!0},undoText:{type:String,default:"撤销"},redoText:{type:String,default:"重做"},clearText:{type:String,default:"清空"},confirmText:{type:String,default:"确定"},customStyle:{type:Object,default:new UTSJSONObject(new UTSJSONObject({}))},customCanvasStyle:{type:Object,default:new UTSJSONObject(new UTSJSONObject({}))},customActionAreaStyle:{type:Object,default:new UTSJSONObject(new UTSJSONObject({}))}},emits:["confirm","undo","redo","clear"],setup(e,t){var O=t.expose,B=t.emit;const N=l.utils,z=l.colors,A=B,M=e,$=N.randomComId(),D=a(0),H=a(null),P=a(null),E=a(null),X=a(null),Y=a(0),F=a(0),L=a(0),I=a([]),W=a(-1),q=a(!1),G=a([]),K=n((()=>new UTSJSONObject({penSize:M.penSize,penColor:M.penColor,height:M.height,maxHistory:M.maxHistory}))),Q=n((()=>m("color",M.bgColor,z.value.front))),V=n((()=>m("color",M.textColor,z.value.line))),Z=n((()=>m("color",M.penColor,z.value.text))),ee=n((()=>N.addPx(Y.value/M.text.length*.8))),te=n((()=>m("radius",M.borderRadius,l.configs.radius.normal))),le=n((()=>{let e=new Map;return e.set("height",M.height),e.set("border-radius",te.value),e.set("background",Q.value),e.set("transition-duration",l.configs.aniTime.normal),e})),ae=n((()=>{let e=new Map;return e.set("transition-duration",l.configs.aniTime.normal),e})),ne=n((()=>{let e=new Map;return e.set("flex-direction","row"),e.set("align-items","center"),e.set("justify-content","flex-end"),e.set("margin-top","5px"),e.set("padding","10px"),e})),ue=n((()=>{let e=new Map;return e.set("margin-left",M.buttonSpacing),e}));function oe(e){if(null!=E.value&&G.value.length>1){let t=G.value[G.value.length-2];E.value.beginPath(),E.value.moveTo(t.x,t.y),E.value.lineTo(e.x,e.y),E.value.stroke(),E.value.closePath(),E.value.save()}}function se(e){if(null!=E.value){for(let t=0;t<e.length;t++)G.value.push(e[t]),oe(e[t]);G.value=[]}}function ie(){if(null!=E.value){E.value.strokeStyle=Z.value,E.value.fillStyle=Z.value,E.value.clearRect(0,0,X.value.width,X.value.height);for(let e=0;e<=W.value;e++)se(I.value[e])}}function re(){if(W.value<0||0==I.value.length)return null;null!=E.value&&I.value.length>0&&W.value>=0&&(W.value--,ie(),A("undo"))}function de(){if(0==I.value.length||W.value>=I.value.length-1)return null;null!=E.value&&W.value<=I.value.length-1&&(W.value++,ie(),A("redo"))}function ve(){null!=E.value&&E.value.clearRect(0,0,X.value.width,X.value.height),I.value=[],G.value=[],W.value=-1,A("clear")}function ce(){M.showClearTip?b({title:"提示",content:M.clearTip,success:function(e){e.confirm&&ve()}}):ve()}function fe(){A("confirm")}function pe(e,t){return new J({x:e-F.value,y:t-L.value})}function ge(){var e,t,l,a;let n=null===(e=H.value)||void 0===e?void 0:e.getBoundingClientRect();Y.value=null!==(t=null==n?void 0:n.width)&&void 0!==t?t:0,L.value=null!==(l=null==n?void 0:n.top)&&void 0!==l?l:0,F.value=null!==(a=null==n?void 0:n.left)&&void 0!==a?a:0}function ye(e,t){ge(),q.value=!0;let l=pe(e,t);G.value.push(l)}function he(e){e.preventDefault();let t=e.touches[0];ye(t.clientX,t.clientY)}function me(e,t){if(!q.value)return null;let l=pe(e,t);G.value.push(l),oe(l)}function be(e){e.preventDefault();let t=e.touches[0];me(t.clientX,t.clientY)}function xe(e){if(0==G.value.length)return null;W.value+1<I.value.length?(I.value=I.value.slice(0,W.value+1),I.value.push(G.value),W.value++):(W.value++,I.value.push(G.value)),G.value=[],e.preventDefault(),q.value=!1}function Se(e){e.preventDefault(),ye(e.clientX,e.clientY)}function we(e){xe(e)}function _e(e){me(e.clientX,e.clientY),e.preventDefault()}function Te(){I.value=[],G.value=[],W.value=-1,_({id:$,success:e=>{var t;P.value=e,E.value=e.getContext("2d"),X.value=E.value.canvas,D.value=null!==(t=C().devicePixelRatio)&&void 0!==t?t:1,X.value.width=X.value.offsetWidth*D.value,X.value.height=X.value.offsetHeight*D.value,E.value.scale(D.value,D.value),E.value.restore(),null!=E.value&&(E.value.lineCap="round",E.value.lineJoin="round",E.value.lineWidth=M.penSize,E.value.strokeStyle=Z.value,E.value.fillStyle=Z.value),ge()}})}return O({undo:re,redo:de,clear:ce,getBase64:function(){return null!=P.value?P.value.toDataURL():""}}),u((()=>l.configs.app.theme),(()=>{ie()})),u(K,(()=>{s((()=>{Te()}))})),o((()=>{s((()=>{}))})),i((()=>{window.addEventListener("mouseup",we),window.addEventListener("mousemove",_e),s((()=>{Te()}))})),(t=null,l=null)=>{const a=j(r("sn-text"),k),n=T,u=x,o=j(r("sn-button"),U),s=j(r("sn-view"),R);return S(),d(h,null,[v(u,{class:"sn-signature-contain",style:f([p(le),e.customStyle])},{default:c((()=>[v(a,{align:"center",text:e.text,font:e.textFont,color:p(V),size:p(ee)},null,8,["text","font","color","size"]),v(u,{class:"sn-signature-board",ref_key:"boardEle",ref:H,onTouchstart:he,onTouchend:xe,onTouchcancel:xe,onTouchmove:be,onMousedown:Se,style:f([p(ae),e.customStyle])},{default:c((()=>[v(n,{class:"sn-signature-canvas",id:p($),style:f([e.customCanvasStyle])},null,8,["id","style"])])),_:1},8,["style"])])),_:1},8,["style"]),e.showAction?g(t.$slots,"action",{key:0},(()=>[v(s,{class:"sn-signature-action-area",disabled:e.disabled,bgColor:p(Q),borderRadius:p(te),style:f([p(ne),e.customActionAreaStyle])},{default:c((()=>[e.showClear?(S(),w(o,{key:0,type:"error",level:"second",text:e.clearText,disabled:e.disabled||0==p(I).length,onClick:ce,style:f([p(ue)])},null,8,["text","disabled","style"])):y("",!0),e.showUndo?(S(),w(o,{key:1,text:e.undoText,disabled:e.disabled||0==p(I).length||p(W)<0||p(W)==p(I).length-e.maxHistory-1,onClick:re,style:f([p(ue)])},null,8,["text","disabled","style"])):y("",!0),e.showRedo?(S(),w(o,{key:2,text:e.redoText,disabled:e.disabled||0==p(I).length||p(W)>=p(I).length-1,onClick:de,style:f([p(ue)])},null,8,["text","disabled","style"])):y("",!0),e.showConfirm?(S(),w(o,{key:3,type:"primary",text:e.confirmText,disabled:e.disabled,onClick:fe,style:f([p(ue)])},null,8,["text","disabled","style"])):y("",!0)])),_:1},8,["disabled","bgColor","borderRadius","style"])]),!0):y("",!0)],64)}}})),[["__scopeId","data-v-700f217e"]]),$=t({__name:"sn-signature",setup(t){l.colors,l.utils;const n=a(""),u=a(null),o=a(null);function s(){var e,t,l;n.value=null!==(l=null===(t=null===(e=o.value)||void 0===e?void 0:e.getBase64)||void 0===t?void 0:t.call(e))&&void 0!==l?l:""}return(t=null,l=null)=>{const a=j(r("sn-topbar"),e),i=j(r("com-card"),O),d=j(r("sn-signature"),M),f=j(r("sn-button"),U),g=j(r("sn-image"),N),y=j(r("sn-gap"),z),h=j(r("sn-page"),A);return S(),w(h,null,{default:c((()=>[v(a,{title:"Signature 签名"}),v(i,{title:"基础用法",note:"基于 canvas 的签名板，适配各端，内置一套精美模版，提供 20+ 属性，支持插槽定制操作栏，任意搭配"}),v(d,{ref_key:"signEle",ref:o},null,512),v(i,{title:"导出图片",note:"支持导出为 base64 图片，App 端还可利用 view 进行组件截图生成 png 图片"},{default:c((()=>[v(f,{text:"导出为 base64",onClick:s})])),_:1}),v(i,null,{default:c((()=>[v(g,{ref_key:"imageEle",ref:u,class:"m-t-10",enablePreview:"",src:p(n)},null,8,["src"])])),_:1}),v(y)])),_:1})}}});export{$ as default};
