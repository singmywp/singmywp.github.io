import{_ as e}from"./sn-topbar.wm0GzhH3.js";import{d as t,$ as a,r as o,c as l,a as s,e as u,f as n,x as r,a8 as i,_ as d,b as p,h as c,j as m,u as f,F as h,p as g,z as y,g as v,B as b,aG as x,aH as w,aI as S,aJ as T,aK as C,aL as _,aM as U,aN as M,L as j}from"./index-DYMgrqHp.js";import{r as P}from"./uni-app.es.DgDfNdgy.js";import{_ as O}from"./com-card.BtLNzB63.js";import{_ as R}from"./sn-image.C1FMMqQw.js";import{_ as k,a as B,b as E}from"./sn-text.euomPoe8.js";import{_ as N}from"./sn-view.BSUxthDa.js";import{_ as z}from"./sn-button.BjZePiC5.js";import{_ as F}from"./sn-gap.2Twkbobz.js";import{_ as D}from"./sn-page.Cf6LEMVT.js";import"./sn-menu-item.DkjoXkWj.js";import"./sn-overlay.CiZFgEyq.js";import"./useResize.Cfi37DcV.js";import"./sn-loading.t5otRKvs.js";const J=E(t(Object.assign({name:"sn-upload-media"},{__name:"sn-upload-media",props:{mode:{type:String,default:"image"},autoUpload:{type:Boolean,default:!0},url:{type:String,default:""},chooseCount:{type:Number,default:20},maxCount:{type:Number,default:-1},timeout:{type:Number,default:1e4},formData:{type:Object,default:{}},sourceType:{type:Array,default:["album","camera"]},width:{type:String,default:"70px"},height:{type:String,default:"70px"},itemBgColor:{type:String,default:""},itemBorderRadius:{type:String,default:""},iconSize:{type:String,default:"40px"},disabled:{type:Boolean,default:!1},chooseErrorTip:{type:String,default:"选择媒体文件失败"},enablePreview:{type:Boolean,default:!0},uploadingText:{type:String,default:"上传中"},uploadedText:{type:String,default:"上传成功"},unuploadedText:{type:String,default:"未上传"},errorText:{type:String,default:"上传失败"},clearable:{type:Boolean,default:!0},compressed:{type:Boolean,default:!0},maxDuration:{type:Number,default:60},customStyle:{type:Object,default:new UTSJSONObject({})},customItemStyle:{type:Object,default:new UTSJSONObject({})}},emits:["uploaded","image-chose","video-chose","file-chose","upload-error","choose-error"],setup(e,t){var M=t.expose,j=t.emit;const O=a.utils,E=a.colors,z=j,F=e,D=o([]),J=o(null),$=l((()=>{let e=Math.min(O.getPx(F.width),O.getPx(F.height));return O.addPx(e)})),I=l((()=>["image","video","all"].includes(F.mode)?F.mode:"image")),L=l((()=>O.addPx(O.getPx($.value)/3.75))),A=l((()=>r("color",F.itemBgColor,E.value.line))),V=l((()=>r("radius",F.itemBorderRadius,a.configs.radius.small))),H=l((()=>{const e=new Map;return e.set("width",F.width),e.set("height",F.height),e.set("margin-bottom","5px"),e.set("margin-right","5px"),e.set("transition-duration",a.configs.aniTime.normal),e})),K=l((()=>{const e=new Map;return e.set("background",A.value),e.set("transition-duration",a.configs.aniTime.normal),e})),W=l((()=>{const e=new Map;return e.set("position","absolute"),e.set("right","0px"),e.set("top","0px"),e.set("transition-duration",a.configs.aniTime.normal),e})),G=l((()=>{const e=new Map;return e.set("position","absolute"),e.set("left","0px"),e.set("right","0px"),e.set("bottom","0px"),e.set("padding","2px"),e.set("background","rgba(0,0,0,0.5)"),e.set("transition-duration",a.configs.aniTime.normal),e})),Q=l((()=>{const e=new Map;return e.set("width",F.width),e.set("height",F.height),e.set("borderRadius",V.value),e})),Z=o(0);function q(e){return x(this,void 0,void 0,(function*(){if(Z.value>=e.length)return Z.value=0,Promise.resolve(null);let t=e[Z.value],a=-1;D.value.forEach(((e,o)=>{e.name==t.name&&(a=o,e.status="uploading")})),J.value=w({url:F.url,formData:F.formData,files:[t],timeout:F.timeout,success:e=>{200==e.statusCode?(-1!=a&&(D.value[a].status="uploaded"),z("uploaded",e)):(z("upload-error",new i("components","snUploadMedia",9010009,new Error(e.data))),-1!=a&&(D.value[a].status="error"))},fail:e=>{z("upload-error",new i("components","snUploadMedia",9010009,new Error(e.errMsg,{cause:e.cause}))),-1!=a&&602001!=e.errCode&&(D.value[a].status="error")},complete:(t=null)=>{Z.value++,q(e)}})}))}function X(){if(O.isEmpty(F.url))return console.error("sn-upload-media: 请先绑定上传 URL 地址"),z("upload-error",new i("components","snUploadMedia",9010007)),null;let e=[];D.value.forEach((t=>{var a;"unuploaded"!=t.status&&"error"!=t.status||e.push({name:t.name,uri:null!==(a=t.src)&&void 0!==a?a:"",file:t.file})})),q(e)}function Y(e){if(F.maxCount>0&&D.value.length>=F.maxCount)return null;"video"==e.type&&null!=e.src&&(e.thumb=(e.src,"")),D.value.push(e)}return M({upload:X}),(t=null,a=null)=>{const o=P(s("sn-image"),R),l=U,r=P(s("sn-icon"),k),x=P(s("sn-text"),B),w=d,M=P(s("sn-view"),N);return p(),u(w,{class:"sn-upload-media-group"},{default:n((()=>[(p(!0),c(h,null,m(f(D),((t,a)=>(p(),u(M,{class:"sn-upload-media-item",key:a,disabled:e.disabled,borderRadius:f(V),style:g([f(H)])},{default:n((()=>{var s,i,d;return["image"==t.type?(p(),u(o,{key:0,mode:"scaleToFill",src:null!==(s=t.src)&&void 0!==s?s:"",width:e.width,height:e.height,borderRadius:f(V),enablePreview:e.enablePreview},null,8,["src","width","height","borderRadius","enablePreview"])):"video"==t.type?(p(),u(l,{key:1,src:null!==(i=t.src)&&void 0!==i?i:"",controls:!1,poster:null!==(d=t.thumb)&&void 0!==d?d:"","show-center-play-btn":!1,style:g(f(Q))},null,8,["src","poster","style"])):b("",!0),e.clearable?(p(),u(r,{key:2,name:"close-circle-fill",class:"sn-upload-media-item-close",color:"$error",size:f(L),style:g(f(W)),onClick:(e=null)=>function(e,t=null){"uploading"==D.value[e].status&&null!=J.value&&J.value.abort(),D.value.splice(e,1),t.preventDefault(),t.stopPropagation()}(a,e)},null,8,["size","style","onClick"])):b("",!0),v(w,{style:g(f(G))},{default:n((()=>[v(x,{align:"center",text:"uploaded"==t.status?e.uploadedText:"unuploaded"==t.status?e.unuploadedText:"error"==t.status?e.errorText:e.uploadingText,color:"uploaded"==t.status?f(E).success:"unuploaded"==t.status?f(E).front:"error"==t.status?f(E).error:f(E).front},null,8,["text","color"])])),_:2},1032,["style"])]})),_:2},1032,["disabled","borderRadius","style"])))),128)),e.maxCount<=0||f(D).length<e.maxCount?(p(),u(M,{key:0,class:"sn-upload-media-item",disabled:e.disabled,borderRadius:f(V),style:g([f(H)]),onClick:a[0]||(a[0]=(e=null)=>function(){if(F.disabled)return null;"image"==I.value?S(new UTSJSONObject({count:F.chooseCount,sourceType:F.sourceType,success:e=>{z("image-chose",e),e.tempFiles.forEach(((e=null)=>{Y(new T({file:e,src:e.path,name:O.uuid(),status:"unuploaded",type:"image"}))})),F.autoUpload&&X()},fail:e=>{1101001!=e.errCode&&z("choose-error",new i("components","snUploadMedia",9010010,new Error(e.errMsg,{cause:e.cause})))}})):"video"==I.value?C(new UTSJSONObject({sourceType:F.sourceType,maxDuration:F.maxDuration,success:e=>{z("video-chose",e),Y(new T({file:e.tempFile,src:e.tempFilePath,name:O.uuid(),status:"unuploaded",type:"video"})),F.autoUpload&&X()},fail:e=>{1101001!=e.errCode&&z("choose-error",new i("components","snUploadMedia",9010010,new Error(e.errMsg,{cause:e.cause})))}})):"all"==I.value&&O.chooseMedia(new _({type:"all",multiple:F.chooseCount>1,maxCount:Math.max(F.chooseCount,1),success:e=>{z("file-chose",e),e.forEach((e=>{Y(new T({src:e.path,name:O.uuid(),status:"unuploaded",type:O.isVideo("a."+e.ext)?"video":"image"}))})),F.autoUpload&&X()},fail:e=>{z("choose-error",e)}}))}())},{default:n((()=>[y(t.$slots,"default",{},(()=>[v(w,{class:"sn-upload-media-item-placeholder",style:g([f(K)])},{default:n((()=>[v(r,{name:"add-line",color:"$lineText",size:e.iconSize},null,8,["size"])])),_:1},8,["style"])]),!0)])),_:3},8,["disabled","borderRadius","style"])):b("",!0)])),_:3})}}})),[["__scopeId","data-v-129b6386"]]),$=E(t(Object.assign({name:"sn-upload-media-unicloud"},{__name:"sn-upload-media-unicloud",props:{mode:{type:String,default:"image"},autoUpload:{type:Boolean,default:!0},chooseCount:{type:Number,default:20},maxCount:{type:Number,default:-1},sourceType:{type:Array,default:["album","camera"]},width:{type:String,default:"70px"},height:{type:String,default:"70px"},itemBgColor:{type:String,default:""},itemBorderRadius:{type:String,default:""},iconSize:{type:String,default:"40px"},disabled:{type:Boolean,default:!1},chooseErrorTip:{type:String,default:"选择媒体文件失败"},directory:{type:String,default:"uploadImages/"},uploadingText:{type:String,default:"上传中"},uploadedText:{type:String,default:"上传成功"},unuploadedText:{type:String,default:"未上传"},errorText:{type:String,default:"上传失败"},clearable:{type:Boolean,default:!0},enablePreview:{type:Boolean,default:!0},compressed:{type:Boolean,default:!0},maxDuration:{type:Number,default:60},customStyle:{type:Object,default:new UTSJSONObject({})},customItemStyle:{type:Object,default:new UTSJSONObject({})}},emits:["uploaded","upload-error","choose-error","image-chose","video-chose","file-chose"],setup(e,t){var w=t.expose,j=t.emit;const O=a.utils,E=a.colors,z=j,F=e,D=o([]),J=l((()=>{let e=Math.min(O.getPx(F.width),O.getPx(F.height));return O.addPx(e)})),$=l((()=>["image","video","all"].includes(F.mode)?F.mode:"image")),I=l((()=>O.addPx(O.getPx(J.value)/3.75))),L=l((()=>r("color",F.itemBgColor,E.value.line))),A=l((()=>r("radius",F.itemBorderRadius,a.configs.radius.small))),V=l((()=>{const e=new Map;return e.set("width",F.width),e.set("height",F.height),e.set("margin-bottom","5px"),e.set("margin-right","5px"),e.set("transition-duration",a.configs.aniTime.normal),e})),H=l((()=>{const e=new Map;return e.set("background",L.value),e.set("transition-duration",a.configs.aniTime.normal),e})),K=l((()=>{const e=new Map;return e.set("position","absolute"),e.set("right","0px"),e.set("top","0px"),e.set("transition-duration",a.configs.aniTime.normal),e})),W=l((()=>{const e=new Map;return e.set("position","absolute"),e.set("left","0px"),e.set("right","0px"),e.set("bottom","0px"),e.set("padding","2px"),e.set("background","rgba(0,0,0,0.5)"),e.set("transition-duration",a.configs.aniTime.normal),e})),G=l((()=>{const e=new Map;return e.set("width",F.width),e.set("height",F.height),e.set("borderRadius",A.value),e}));function Q(){if(null==M){let e=new i("components","snUploadMediaUnicloud",9010006);return console.error(e),z("upload-error",e),null}let e=[];D.value.forEach((t=>{var a;"unuploaded"!=t.status&&"error"!=t.status||e.push({name:t.name,uri:null!==(a=t.src)&&void 0!==a?a:"",file:t.file})})),function(e){x(this,void 0,void 0,(function*(){let t=F.directory;F.directory.endsWith("/")||(t+="/"),F.directory.startsWith("/")&&(t=F.directory.slice(1));for(let a=0;a<e.length;a++){let o=e[a],l="";if(null==o.file)throw new i("components","snUploadMediaUnicloud",9010008);if("all"==$.value){let e=o.file.ext;l="".concat(O.uuid(),".").concat(e)}else{let e=o.file.type;if(null==e&&null==e)throw new i("components","snUploadMediaUnicloud",9010008);e=e.split("/")[1],l="".concat(O.uuid(),".").concat(e)}let s=t+l,u=-1;if(D.value.forEach(((e,t)=>{e.name==o.name&&(u=t,e.status="uploading")})),null!=M)yield M.uploadFile({filePath:o.uri,cloudPath:s,cloudPathAsRealPath:!0}).then((e=>{-1!=u&&(D.value[u].status="uploaded"),z("uploaded",e)})).catch(((e=null)=>{console.error("sn-upload-media-unicloud: 上传失败",e),-1!=u&&(D.value[u].status="error"),z("upload-error",new i("components","snUploadMediaUnicloud",9010009))}));else{let e=new i("components","snUploadMediaUnicloud",9010006);console.error(e),z("upload-error",e)}}}))}(e)}function Z(e){if(F.maxCount>0&&D.value.length>=F.maxCount)return null;"video"==e.type&&null!=e.src&&(e.thumb=(e.src,"")),D.value.push(e)}return w({upload:Q}),(t=null,a=null)=>{const o=P(s("sn-image"),R),l=U,r=P(s("sn-icon"),k),x=P(s("sn-text"),B),w=d,M=P(s("sn-view"),N);return p(),u(w,{class:"sn-upload-media-unicloud-group",style:g(e.customStyle)},{default:n((()=>[(p(!0),c(h,null,m(f(D),((t,a)=>(p(),u(M,{class:"sn-upload-media-unicloud-item",key:a,disabled:e.disabled,borderRadius:f(A),style:g([f(V),e.customItemStyle])},{default:n((()=>{var s,i,d;return["image"==t.type?(p(),u(o,{key:0,mode:"scaleToFill",src:null!==(s=t.src)&&void 0!==s?s:"",width:e.width,height:e.height,borderRadius:f(A),enablePreview:e.enablePreview},null,8,["src","width","height","borderRadius","enablePreview"])):"video"==t.type?(p(),u(l,{key:1,src:null!==(i=t.src)&&void 0!==i?i:"",controls:!1,poster:null!==(d=t.thumb)&&void 0!==d?d:"","show-center-play-btn":!1,style:g(f(G))},null,8,["src","poster","style"])):b("",!0),e.clearable?(p(),u(r,{key:2,name:"close-circle-fill",class:"sn-upload-media-unicloud-item-close",color:"$error",size:f(I),style:g(f(K)),onClick:(e=null)=>function(e,t=null){"uploading"!=D.value[e].status&&D.value.splice(e,1),t.preventDefault(),t.stopPropagation()}(a,e)},null,8,["size","style","onClick"])):b("",!0),v(w,{style:g(f(W))},{default:n((()=>[v(x,{align:"center",text:"uploaded"==t.status?e.uploadedText:"unuploaded"==t.status?e.unuploadedText:"error"==t.status?e.errorText:e.uploadingText,color:"uploaded"==t.status?f(E).success:"unuploaded"==t.status?f(E).front:"error"==t.status?f(E).error:f(E).front},null,8,["text","color"])])),_:2},1032,["style"])]})),_:2},1032,["disabled","borderRadius","style"])))),128)),e.maxCount<=0||f(D).length<e.maxCount?(p(),u(M,{key:0,class:"sn-upload-media-unicloud-item",disabled:e.disabled,borderRadius:f(A),style:g([f(V)]),onClick:a[0]||(a[0]=(e=null)=>function(){if(F.disabled)return null;"image"==$.value?S(new UTSJSONObject({count:F.chooseCount,sourceType:F.sourceType,success:e=>{z("image-chose",e),e.tempFiles.forEach(((e=null)=>{Z(new T({file:e,src:e.path,name:O.uuid(),status:"unuploaded",type:"image"}))})),F.autoUpload&&Q()},fail:e=>{if(1101001!=e.errCode){let t=new i("components","snUploadMediaUnicloud",9010010,new Error(e.errMsg,{cause:e.cause}));z("choose-error",t)}}})):"video"==$.value?C(new UTSJSONObject({sourceType:F.sourceType,maxDuration:F.maxDuration,success:e=>{z("video-chose",e),Z(new T({file:e.tempFile,src:e.tempFilePath,name:O.uuid(),status:"unuploaded",type:"video"})),F.autoUpload&&Q()},fail:e=>{if(1101001!=e.errCode){let t=new i("components","snUploadMediaUnicloud",9010010,new Error(e.errMsg,{cause:e.cause}));z("choose-error",t)}}})):"all"==$.value&&O.chooseMedia(new _({type:"all",multiple:F.chooseCount>1,maxCount:Math.max(F.chooseCount,1),success:e=>{z("file-chose",e),e.forEach((e=>{Z(new T({src:e.path,name:O.uuid(),status:"unuploaded",type:O.isVideo("a."+e.ext)?"video":"image",file:e}))})),F.autoUpload&&Q()},fail:e=>{z("choose-error",e)}}))}())},{default:n((()=>[y(t.$slots,"default",{},(()=>[v(w,{class:"sn-upload-media-unicloud-item-placeholder",style:g([f(H)])},{default:n((()=>[v(r,{name:"add-line",color:"$lineText",size:e.iconSize},null,8,["size"])])),_:1},8,["style"])]),!0)])),_:3},8,["disabled","borderRadius","style"])):b("",!0)])),_:3},8,["style"])}}})),[["__scopeId","data-v-0ad27ca8"]]),I='https://unidemo.dcloud.net.cn/upload"',L=t({__name:"sn-upload-media",setup(t){const a=o(null);function l(){var e,t;null===(t=null===(e=a.value)||void 0===e?void 0:e.upload)||void 0===t||t.call(e)}return(t=null,o=null)=>{const r=P(s("sn-topbar"),e),i=P(s("com-card"),O),d=P(s("sn-upload-media"),J),c=P(s("sn-upload-media-unicloud"),$),m=P(s("sn-text"),B),f=j,h=P(s("sn-button"),z),g=P(s("sn-gap"),F),y=P(s("sn-page"),D);return p(),u(y,null,{default:n((()=>[v(r,{title:"Upload Media 媒体上传"}),v(i,{title:"基础用法",note:"本组件用于快速上传图片/视频媒体文件，分为基础版和 uniCloud 版"}),v(i,{title:"基础版",note:"基于 uni.uploadFile，可上传到开发者服务器"},{default:n((()=>[v(d,{url:I})])),_:1}),v(i,{title:"uniCloud 版",note:"基于 uniCloud.uploadFile，需先绑定服务空间"},{default:n((()=>[v(c)])),_:1}),v(i,{title:"上传视频",note:"支持视频上传，支持显示缩略图。"},{default:n((()=>[v(d,{mode:"video",url:I})])),_:1}),v(i,{title:"视频图片混传",note:"mode 设为 all 以支持视频图片混传，使用系统相册选择"},{default:n((()=>[v(d,{mode:"all",url:I})])),_:1}),v(i,{title:"限制数量",note:"可以限制选择数量以及最大总数量.图片每次最多选择 20 个，视频每次最多选择1个。"},{default:n((()=>[v(m,{class:"m-b-10",text:"选择：最大 3 张\n总数：最大 4 张"}),v(d,{url:I,chooseCount:3,maxCount:4})])),_:1}),v(i,{title:"自定义样式",note:"可以自定义占位图，自定义尺寸、圆角、背景颜色、图标颜色、大小等"},{default:n((()=>[v(d,{width:"280px",height:"173px",chooseCount:1,maxCount:1,url:I},{default:n((()=>[v(f,{mode:"widthFix",src:"/demo/assets/idcard-DtU4HE31.png",style:{width:"280px",height:"173px"}})])),_:1})])),_:1}),v(i,{title:"删除按钮",note:"可以取消显示删除按钮"},{default:n((()=>[v(d,{url:I,clearable:!1})])),_:1}),v(i,{title:"图片预览",note:"选择的图片默认可点击预览，如果怕点错，可以取消。视频文件不支持点击预览。"},{default:n((()=>[v(d,{url:I,enablePreview:!1})])),_:1}),v(i,{title:"手动上传",note:"设置 autoUpload=false 即可通过 upload 方法手动上传"},{default:n((()=>[v(d,{ref_key:"mediaRef",ref:a,url:I,autoUpload:!1},null,512),v(h,{class:"m-t-10",type:"primary",level:"second",text:"上传",onClick:l})])),_:1}),v(g,{height:"40px"})])),_:1})}}});export{L as default};
