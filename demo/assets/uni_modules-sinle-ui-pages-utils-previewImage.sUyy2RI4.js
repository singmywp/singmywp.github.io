import{d as e,$ as l,an as a,au as n,r as u,aU as s,o as t,n as o,a as i,b as c,e as v,f as r,g as f,u as d,av as p,aV as m,L as g,q as h,aW as P}from"./index-DYMgrqHp.js";import{_ as y}from"./sn-view.BSUxthDa.js";import{a as A,d as w,r as _}from"./uni-app.es.DgDfNdgy.js";import{b}from"./sn-text.euomPoe8.js";import"./sn-loading.t5otRKvs.js";const x=b(e({__name:"previewImage",setup(e){const b=l.utils,x=a(new n({urls:[""]})),E=u(""),T=u(0),j=u([]),D=u([]),I=u(null),S=h(),L=u(!1),k=u(null),F=u(1),G=u(0),M=u(0),O=u(0),U=u(0),$=u(0),C=u(0),J=u(0),R=u(0),V=u(0),W=u(!1);function X(e,l){if(null==I.value)return null;I.value.$el.style.setProperty(e,l)}function Y(){!function(e,l){if(null==k.value)return null;k.value.style.setProperty(e,l)}("transform","scale(".concat(F.value,") translate(").concat(G.value,"px, ").concat(M.value,"px)"))}function q(){L.value=!0,setTimeout((()=>{L.value=!1}),200)}function z(e){F.value=Math.max(F.value*e.zoom,1),Y()}function N(){var e;if(1!=O.value||W.value)return null;W.value=!0;let l=[];if(null!=(null===(e=x.longPressActions)||void 0===e?void 0:e.actions)&&(l=x.longPressActions.actions),0==l.length)return null;b.showActionsheet(new p({actions:l,success:e=>{var l,a,n,u;null!=(null===(l=x.longPressActions)||void 0===l?void 0:l.success)?null===(n=(a=x.longPressActions).success)||void 0===n||n.call(a,e):null==(null===(u=x.longPressActions)||void 0===u?void 0:u.actions)&&(0==e?j.value[T.value]:1==e&&function(){let e=j.value[T.value];b.isURL(e)&&(b.isEmpty(D.value[T.value])?P({url:e,success:e=>{200==e.statusCode&&(D.value[T.value]=e.tempFilePath,e.tempFilePath)}}):D.value[T.value])}())},fail:e=>{var l,a,n;null!=(null===(l=x.longPressActions)||void 0===l?void 0:l.fail)&&(null===(n=(a=x.longPressActions).fail)||void 0===n||n.call(a,e))},complete:(e=null)=>{var l,a,n;W.value=!1,null!=(null===(l=x.longPressActions)||void 0===l?void 0:l.complete)&&(null===(n=(a=x.longPressActions).complete)||void 0===n||n.call(a,e))}}))}function Z(e){e.event.preventDefault(),R.value=e.event.timeStamp,O.value=e.touches.length,1==O.value&&(C.value=e.touches[0].x,J.value=e.touches[0].y)}function B(e){e.event.preventDefault(),V.value=e.event.timeStamp,1==O.value&&0==e.touches[0].diffX&&0==e.touches[0].diffY&&(V.value-R.value<400?b.debounce((()=>{if(L.value)return null;X("opacity","0"),setTimeout((()=>{m(new UTSJSONObject({dialogPage:S.proxy.$page}))}),300)}),200,"previewImage"):N()),O.value=0,U.value=G.value,$.value=M.value}function H(e){e.event.preventDefault(),O.value=e.touches.length;const l=e.touches.map((e=>e.diffX)).reduce(((e,l)=>e+l),0)/e.touches.length,a=e.touches.map((e=>e.diffY)).reduce(((e,l)=>e+l),0)/e.touches.length;G.value=l+U.value,M.value=a+$.value,Y()}return A((e=>{if(null!=e.id){E.value=e.id;let l=s.get("DIALOGPAGE_PREVIEWIMAGE_".concat(e.id));if(null!=l){let e=l;x.urls=e.urls,j.value=e.urls;for(let l=0;l<j.value.length;l++)D.value.push("");x.longPressActions=e.longPressActions}}})),w((()=>{let e=l.configs.app.grayMode;window.document.body.style.filter=e?"grayscale(100%)":""})),t((()=>{o((()=>{X("opacity","1")})),document.addEventListener("contextmenu",(function(e=null){e.preventDefault()}))})),(e=null,l=null)=>{const a=g,n=_(i("sn-view"),y);return c(),v(n,{class:"sn-image-previewer",bgColor:"#000",aniTime:"300ms",ref_key:"previewerEle",ref:I,onDbclick:q,onLongpress:N,onScale:z,onTouchstart:Z,onTouchmove:H,onTouchend:B,onTouchcancel:B},{default:r((()=>[f(a,{class:"sn-image-previewer-image",mode:"aspectFit",ref_key:"imageEle",ref:k,src:d(j).length>=1?d(j)[d(T)]:""},null,8,["src"])])),_:1},512)}}}),[["__scopeId","data-v-77b4bbd2"]]);export{x as default};
